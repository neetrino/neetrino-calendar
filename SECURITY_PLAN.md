# SECURITY_PLAN.md

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.01.2026  
**–ü—Ä–æ–µ–∫—Ç:** Calendar App Security Hardening  
**–°—Ç–∞—Ç—É—Å:** üü° –í –ø—Ä–æ—Ü–µ—Å—Å–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

---

## –û–ë–ó–û–† –ü–õ–ê–ù–ê

–ü–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω –≤–Ω–µ–¥—Ä–µ–Ω–∏—è security –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ `SECURITY_AUDIT.md`. –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–Ω–µ–¥—Ä—è—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º breaking changes. –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è feature flags –≥–¥–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

---

## –≠–¢–ê–ü 1: QUICK WINS (–ë—ã—Å—Ç—Ä—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è) ‚Äî –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 1

### 1.1 Security Headers
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç XSS, clickjacking, MIME sniffing  
**–í—Ä–µ–º—è:** 15 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- `next.config.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å headers config
- `src/middleware.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å headers –≤ response

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í—Å–µ security headers —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- ‚úÖ CSP –Ω–µ –ª–æ–º–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª
- ‚úÖ Headers —Ä–∞–±–æ—Ç–∞—é—Ç –≤ dev –∏ prod

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å headers —á–µ—Ä–µ–∑ browser DevTools
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–∞–π—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 1.2 Environment Variables Validation
**–¶–µ–ª—å:** –ì–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Å –≤–∞–ª–∏–¥–Ω—ã–º–∏ env  
**–í—Ä–µ–º—è:** 20 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `src/lib/env.ts` (zod schema)
- –û–±–Ω–æ–≤–∏—Ç—å `.env.example`
- –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ `src/lib/db.ts` –∏–ª–∏ `src/app/layout.tsx`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö env
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Å –ø–æ–Ω—è—Ç–Ω—ã–º–∏ –æ—à–∏–±–∫–∞–º–∏
- ‚úÖ `.env.example` –æ–±–Ω–æ–≤–ª–µ–Ω

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –£–¥–∞–ª–∏—Ç—å `AUTH_SECRET` ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ —É–ø–∞—Å—Ç—å —Å –ø–æ–Ω—è—Ç–Ω–æ–π –æ—à–∏–±–∫–æ–π
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –≤—Å–µ env –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è

---

### 1.3 Rate Limiting (–±–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç brute force –∏ DoS  
**–í—Ä–µ–º—è:** 30 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `src/lib/rateLimit.ts` (Vercel-compatible, in-memory –¥–ª—è –Ω–∞—á–∞–ª–∞)
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ `/api/auth/login` (—Å—Ç—Ä–æ–≥–∏–π –ª–∏–º–∏—Ç)
- –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º API endpoints (–º—è–≥–∫–∏–π –ª–∏–º–∏—Ç)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ login (5 req/min)
- ‚úÖ –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –Ω–∞ API (100 req/min)
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç 429 Too Many Requests

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å 10 –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ login ‚Äî –ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–æ–ª–∂–Ω—ã –≤–µ—Ä–Ω—É—Ç—å 429
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–æ—Ö–æ–¥—è—Ç

---

### 1.4 Error Handling & Logging
**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å —É—Ç–µ—á–∫–∏ stack traces, —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏  
**–í—Ä–µ–º—è:** 25 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `src/lib/errors.ts` (error mapper)
- –°–æ–∑–¥–∞—Ç—å `src/lib/logger.ts` (structured logger)
- –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ API routes

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í production –Ω–µ—Ç stack traces –≤ –æ—Ç–≤–µ—Ç–∞—Ö
- ‚úÖ –õ–æ–≥–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã (JSON)
- ‚úÖ PII –∏ —Å–µ–∫—Ä–µ—Ç—ã redacted

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É –≤ API ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç stack trace –≤ –æ—Ç–≤–µ—Ç–µ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ ‚Äî –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã

---

## –≠–¢–ê–ü 2: AUTHENTICATION & AUTHORIZATION ‚Äî –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 2

### 2.1 –£–ª—É—á—à–µ–Ω–∏–µ Cookie Security
**–¶–µ–ª—å:** –£—Å–∏–ª–∏—Ç—å –∑–∞—â–∏—Ç—É —Å–µ—Å—Å–∏–π  
**–í—Ä–µ–º—è:** 10 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- `src/app/api/auth/login/route.ts` ‚Äî –æ–±–Ω–æ–≤–∏—Ç—å cookie settings

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ `SameSite=Strict` –¥–ª—è auth cookies
- ‚úÖ –Ø–≤–Ω—ã–π `path` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- ‚úÖ `secure` –≤ production

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cookie –≤ browser DevTools
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ logout —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### 2.2 –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Email Enumeration
**–¶–µ–ª—å:** –£–±—Ä–∞—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π  
**–í—Ä–µ–º—è:** 15 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- `src/app/api/auth/login/route.ts` ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö/–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö email
- ‚úÖ –û–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ —Ä–∞–∑–ª–∏—á–∏—è

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º email ‚Äî –∑–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º email ‚Äî –≤—Ä–µ–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º
- –û—Ç–≤–µ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∏–¥–µ–Ω—Ç–∏—á–Ω—ã–º–∏

---

### 2.3 CSRF Protection
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç Cross-Site Request Forgery  
**–í—Ä–µ–º—è:** 30 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `src/lib/csrf.ts` (CSRF token generation/validation)
- –û–±–Ω–æ–≤–∏—Ç—å `src/middleware.ts` (–¥–æ–±–∞–≤–∏—Ç—å CSRF check –¥–ª—è –º—É—Ç–∞—Ü–∏–π)
- –û–±–Ω–æ–≤–∏—Ç—å POST/PUT/PATCH/DELETE routes

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ CSRF —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏ –≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –ú—É—Ç–∏—Ä—É—é—â–∏–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç CSRF token
- ‚úÖ GET –∑–∞–ø—Ä–æ—Å—ã –Ω–µ —Ç—Ä–µ–±—É—é—Ç —Ç–æ–∫–µ–Ω (–¥–ª—è –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å POST –±–µ–∑ CSRF token ‚Äî –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 403
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å POST —Å –≤–∞–ª–∏–¥–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º ‚Äî –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ GET –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç –±–µ–∑ —Ç–æ–∫–µ–Ω–∞

---

### 2.4 Authorization Layer (IDOR Protection)
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–∏–º –¥–∞–Ω–Ω—ã–º  
**–í—Ä–µ–º—è:** 45 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `src/lib/authorize.ts` (requireOwner, requireParticipant, checkPermission)
- –û–±–Ω–æ–≤–∏—Ç—å `src/app/api/calendar/items/route.ts` (—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø—Ä–∞–≤–∞–º)
- –û–±–Ω–æ–≤–∏—Ç—å `src/app/api/calendar/items/[id]/route.ts` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞)
- –û–±–Ω–æ–≤–∏—Ç—å `src/app/api/schedule/[id]/route.ts` (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ items –∏–ª–∏ items –≥–¥–µ –æ–Ω —É—á–∞—Å—Ç–Ω–∏–∫
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å/—É–¥–∞–ª—è—Ç—å —á—É–∂–∏–µ items
- ‚úÖ –£—á–∏—Ç—ã–≤–∞—é—Ç—Å—è UserPermission (myLevel, allLevel)

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –°–æ–∑–¥–∞—Ç—å item –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è A
- –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–æ–ª—É—á–∏—Ç—å item –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è B (–¥—Ä—É–≥–æ–π —Å–µ—Å—Å–∏–µ–π) ‚Äî –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 403 –∏–ª–∏ –Ω–µ –ø–æ–∫–∞–∑–∞—Ç—å
- –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –∏–∑–º–µ–Ω–∏—Ç—å —á—É–∂–æ–π item ‚Äî –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å 403

---

### 2.5 Admin Routes Protection –≤ Middleware
**–¶–µ–ª—å:** –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω–∫–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ middleware  
**–í—Ä–µ–º—è:** 15 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- `src/middleware.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–æ–ª–∏ –¥–ª—è `/admin/*`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ù–µ-–∞–¥–º–∏–Ω—ã —Ä–µ–¥–∏—Ä–µ–∫—Ç—è—Ç—Å—è —Å `/admin/*` routes
- ‚úÖ API routes `/api/admin/*` —Ç–∞–∫–∂–µ –∑–∞—â–∏—â–µ–Ω—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –í–æ–π—Ç–∏ –∫–∞–∫ USER ‚Äî –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –∑–∞–π—Ç–∏ –Ω–∞ `/admin/permissions` ‚Äî –¥–æ–ª–∂–µ–Ω —Ä–µ–¥–∏—Ä–µ–∫—Ç
- –í–æ–π—Ç–∏ –∫–∞–∫ ADMIN ‚Äî –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –¥–æ—Å—Ç—É–ø

---

## –≠–¢–ê–ü 3: DATA LAYER & INPUT VALIDATION ‚Äî –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 3

### 3.1 Pagination Limits
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç DoS —á–µ—Ä–µ–∑ –±–æ–ª—å—à–∏–µ –∑–∞–ø—Ä–æ—Å—ã  
**–í—Ä–µ–º—è:** 20 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- `src/app/api/calendar/items/route.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å max limit (1000)
- `src/app/api/users/route.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å max limit
- `src/app/api/schedule/route.ts` ‚Äî –¥–æ–±–∞–≤–∏—Ç—å max limit

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í—Å–µ GET endpoints –∏–º–µ—é—Ç max limit
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –æ—à–∏–±–∫–∞ –µ—Å–ª–∏ limit –ø—Ä–µ–≤—ã—à–µ–Ω

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å —Å limit=10000 ‚Äî –¥–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É
- –ù–æ—Ä–º–∞–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç

---

### 3.2 Mass Assignment Protection
**–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –ø–æ–ª—è –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã  
**–í—Ä–µ–º—è:** 15 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ validation schemas
- –î–æ–±–∞–≤–∏—Ç—å `.strip()` –≥–¥–µ –Ω—É–∂–Ω–æ
- –Ø–≤–Ω–æ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å —á—Ç–æ `role`, `createdById` –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω–µ–Ω—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í—Å–µ —Å—Ö–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `.strip()` –¥–ª—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã—Ö –ø–æ–ª–µ–π
- ‚úÖ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ –ø–æ–ª—è –Ω–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω—ã

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å `role: "ADMIN"` –≤ POST ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ
- –ü–æ–ø—ã—Ç–∞—Ç—å—Å—è –ø–µ—Ä–µ–¥–∞—Ç—å `createdById: "other-id"` ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ–∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–æ

---

### 3.3 Timing Attack Protection
**–¶–µ–ª—å:** –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞  
**–í—Ä–µ–º—è:** 10 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- `src/lib/auth.ts` ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –≤ `getCurrentUser`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö/–Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö userId

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –≤–∞–ª–∏–¥–Ω–æ–≥–æ userId
- –ó–∞–º–µ—Ä–∏—Ç—å –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –¥–ª—è –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ userId ‚Äî –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º

---

## –≠–¢–ê–ü 4: DEPENDENCIES & CI/CD ‚Äî –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 4

### 4.1 Dependency Security Checks
**–¶–µ–ª—å:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π  
**–í—Ä–µ–º—è:** 20 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `.github/dependabot.yml` (–µ—Å–ª–∏ GitHub)
- –î–æ–±–∞–≤–∏—Ç—å `npm audit` –≤ CI (–µ—Å–ª–∏ –µ—Å—Ç—å CI)
- –û–±–Ω–æ–≤–∏—Ç—å `package.json` scripts

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ Dependabot –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–µ—Å–ª–∏ GitHub)
- ‚úÖ `npm audit` –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ CI
- ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–ª–æ–∫–∏—Ä—É—é—Ç –¥–µ–ø–ª–æ–π

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –ó–∞–ø—É—Å—Ç–∏—Ç—å `npm audit` ‚Äî –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ CI –∑–∞–ø—É—Å–∫–∞–µ—Ç audit

---

### 4.2 Security.txt
**–¶–µ–ª—å:** –°–ø–æ—Å–æ–± —Å–≤—è–∑–∞—Ç—å—Å—è –¥–ª—è security issues  
**–í—Ä–µ–º—è:** 5 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `public/.well-known/security.txt`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –§–∞–π–ª –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ `/well-known/security.txt`

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- –û—Ç–∫—Ä—ã—Ç—å `/well-known/security.txt` –≤ –±—Ä–∞—É–∑–µ—Ä–µ

---

## –≠–¢–ê–ü 5: OPTIONAL IMPROVEMENTS ‚Äî –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç 5

### 5.1 Idempotency Keys
**–¶–µ–ª—å:** –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–π  
**–í—Ä–µ–º—è:** 30 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –î–æ–±–∞–≤–∏—Ç—å idempotency key validation –≤ POST/PATCH routes
- –•—Ä–∞–Ω–∏—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–ª—é—á–∏ (in-memory –∏–ª–∏ Redis)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Ç–µ–º –∂–µ –∫–ª—é—á–æ–º –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- ‚úÖ –ö–ª—é—á–∏ expire —á–µ—Ä–µ–∑ 24 —á–∞—Å–∞

---

### 5.2 Audit Logging
**–¶–µ–ª—å:** –ò—Å—Ç–æ—Ä–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π  
**–í—Ä–µ–º—è:** 45 –º–∏–Ω  
**–§–∞–π–ª—ã:**
- –°–æ–∑–¥–∞—Ç—å `src/lib/audit.ts`
- –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å: –∏–∑–º–µ–Ω–µ–Ω–∏—è permissions, —É–¥–∞–ª–µ–Ω–∏—è items, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–æ–ª–µ–π

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ö—Ä–∏—Ç–∏—á–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- ‚úÖ –õ–æ–≥–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç userId, timestamp, action, resource

---

## –ü–û–†–Ø–î–û–ö –í–ù–ï–î–†–ï–ù–ò–Ø

1. ‚úÖ **–≠—Ç–∞–ø 1** (Quick Wins) ‚Äî –Ω–∞—á–∞—Ç—å —Å—Ä–∞–∑—É, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫
2. ‚úÖ **–≠—Ç–∞–ø 2** (Auth & Authz) ‚Äî –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ **–≠—Ç–∞–ø 3** (Data Layer) ‚Äî –≤–∞–∂–Ω–æ –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏
4. ‚è∏Ô∏è **–≠—Ç–∞–ø 4** (Dependencies) ‚Äî –º–æ–∂–Ω–æ –¥–µ–ª–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ
5. ‚è∏Ô∏è **–≠—Ç–∞–ø 5** (Optional) ‚Äî –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

---

## –ö–†–ò–¢–ï–†–ò–ò –ì–û–¢–û–í–ù–û–°–¢–ò (Definition of Done)

–ü—Ä–æ–µ–∫—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –∑–∞—â–∏—â–µ–Ω–Ω—ã–º –∫–æ–≥–¥–∞:

- ‚úÖ –í—Å–µ P0 —Ä–∏—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- ‚úÖ –í—Å–µ P1 —Ä–∏—Å–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã (–∫—Ä–æ–º–µ optional)
- ‚úÖ Security headers —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ Rate limiting —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö endpoints
- ‚úÖ IDOR –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —á—É–∂–∏–º –¥–∞–Ω–Ω—ã–º)
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ Error handling –Ω–µ —É—Ç–µ—á–µ—Ç stack traces
- ‚úÖ Env validation —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã (—Å–º. `TESTING.md`)
- ‚úÖ –ù–µ—Ç breaking changes –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞

---

## ROLLBACK PLAN

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ —Å–ª–æ–º–∞–µ—Ç—Å—è:

1. **Feature Flags:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å env –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è —Ñ–∏—á:
   - `ENABLE_CSRF_PROTECTION=false` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å CSRF
   - `ENABLE_RATE_LIMITING=false` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å rate limiting
   - `ENABLE_STRICT_AUTHORIZATION=false` ‚Äî –æ—Ç–∫–ª—é—á–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

2. **Git Revert:** –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–º –∫–æ–º–º–∏—Ç–µ ‚Äî –º–æ–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å

3. **–ü–æ—ç—Ç–∞–ø–Ω—ã–π Rollback:** –û—Ç–∫–∞—Ç—ã–≤–∞—Ç—å –ø–æ —ç—Ç–∞–ø–∞–º, –Ω–∞—á–∏–Ω–∞—è —Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ

---

## NOTES

- –í—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ dev –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å feature flags –¥–ª—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ–≥–æ rollout
- –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞
- –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ (–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏)

---

## TIMELINE (–û—Ü–µ–Ω–æ—á–Ω–æ)

- **–≠—Ç–∞–ø 1:** 1.5 —á–∞—Å–∞
- **–≠—Ç–∞–ø 2:** 2 —á–∞—Å–∞
- **–≠—Ç–∞–ø 3:** 45 –º–∏–Ω—É—Ç
- **–≠—Ç–∞–ø 4:** 20 –º–∏–Ω—É—Ç
- **–≠—Ç–∞–ø 5:** 1.5 —á–∞—Å–∞ (optional)

**–ò—Ç–æ–≥–æ:** ~4.5 —á–∞—Å–∞ –¥–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (P0+P1)
